{extend name="public/common"}

{block name="style"}
<title>消息审核</title>
<link rel="stylesheet" href="/static/framework7/framework7.ios.colors.css">
<link rel="stylesheet" href="/static/framework7/framework7.ios.css">
<link rel="stylesheet" href="/home/css/approved/passlist.css">
<link rel="stylesheet" href="/home/css/common/tip.css">
<style>
    body{overflow: initial;!important;font-size: 1.4rem;!important;}
</style>
{/block}

{block name="body"}
<div class="list-t-wrap">
    <div class="list-wrapper">
        <!--列表一定要放到容器内,因为会有一个div append到mui-scroll中,需要在底部才能起作用-->
        <div class="list-block" id="list-block-company" style="margin: 0;">
            <div id="nomessage">
                <img src="/home/images/ nomessage.png" alt="" >
            </div>
            <ul>
                {volist name="list" id="vo"}
                <li class="swipeout" style="padding-left: 3vw;background: transparent;height:14.5vh;margin: 0;">
                    <img src="/home/images/approved/icon_bg.png" style="position: absolute;top:2.26vw;left:3vw;width:94vw;height:13.5vh;">
                    {if condition="$vo.type eq 1"}
                    <?php $url = Url('approved/leavedetail?id='.$vo['id'].'&visit=1');?>
                    <div class="swipeout-content" onclick="jump('{$url}')">
                        {elseif condition="$vo.type eq 2"/}
                        <?php $url = Url('approved/tripdetail?id='.$vo['id'].'&visit=1');?>
                        <div class="swipeout-content" onclick="jump('{$url}')">
                            {else/}
                            <?php $url = Url('approved/reimbursementdetail?id='.$vo['id'].'&visit=1');?>
                            <div class="swipeout-content" onclick="jump('{$url}')">
                                {/if}
                                <div class="list">
                                    <span class="title">{$vo.publisher}</span>
                                    <span class="sent_time">
							            <span>{$vo.create_time|time_format='Y-m-d H:i'}</span>
						             </span>
                                    <span class="yuan {eq name='$vo.type' value='1'}qingjia{else/}{eq name='$vo.type' value='2'}chuchai{else/}baoxiao{/eq}{/eq}">{$vo.title}</span>
                                </div>
                                {eq name="$vo.status" value="1"}
                                <div class="arrow green">
                                    同意
                                    <!--<img src="/home/images/review/yes.png" alt="通过">-->
                                </div>
                                {/eq}
                                {eq name="$vo.status" value="-1"}
                                <div class="arrow red">
                                    不同意
                                    <!--<img src="/home/images/review/tanhao.png" alt="拒绝">-->
                                </div>
                                {/eq}
                            </div>
                </li>
                {/volist}
            </ul>
        </div>
        <!--加载更多-->
        <div class="tip"></div>
        <div class="loading hidden">
            <div class="typing_loader"></div>
        </div>
    </div>
</div>
{/block}

{block name="script"}
<script>
    if($("ul").find("li").length == 0){
        $('#nomessage').show()
    }
    function jump(a){
        location.href = a
    }
    var scrollNow = true;
    loadScroll();
    function loadScroll(){
        $(window).off("scroll").on("scroll",function(){
            var dh = $(document).height();
            var end = $(window).height() + $(window ).scrollTop();
            var len = $('.views li').length;
            var tip = $(".tip");
            var loading = $('.loading');
            if(dh == end && scrollNow){
                scrollNow = false;
                $.ajax({
                    type:"post",
                    url: "{:Url('approved/passlistMore')}",
                    data:{
                        length:len
                    },
                    beforeSend: function(XMLHttpRequest){
                        tip.hide();
                        loading.toggleClass('hidden');
                    },
                    success:function(data){
                        console.log(data)
                        loading.toggleClass('hidden');
                        tip.show();
                        if(data.code == 1){
                            addLists(data);
                            if(data.data.length == 5){
                                tip.text('上拉加载更多');

                            }else{

                                tip.text('没有更多了');
                                $(window ).off("scroll");
                            }
                        } else {

                            tip.text('没有更多了');
                            $(window ).off("scroll");
                        }
                        scrollNow = true;
                    }
                })
            }
        })
    }
    function addLists(data){
        var html = '';
        var lists = data.data;
        var len = lists.length;
        for(var i = 0; i< len;i++){
            var _url = '';
            var list = lists[i];
            var _cliass = '';
            if(list.type==1){
                _url = '/home/approved/leavedetail/id/'+list.id+'.html'
                _cliass = 'qingjia'
            }else if(list.type==2){
                _url = '/home/approved/tripdetail/id/'+list.id+'.html'
                _cliass = 'chuchai'
            }else if(list.type==3){
                _url = '/home/approved/reimbursementdetail/id/'+list.id+'.html'
                _cliass = 'baoxiao'
            }
            var Img = '';
            if(list.status == 1){
                Img = '<div class="arrow green">同意</div>'
            }else {
                Img = '<div class="arrow red">不同意</div>'
            }
            html +='<li class="swipeout" style="padding-left: 3vw;background: transparent;height:14.5vh;margin: 0;"><img src="/home/images/approved/icon_bg.png" style="position: absolute;top:2.26vw;left:3vw;width:94vw;height:13.5vh;">'
                    +'<div class="swipeout-content" onclick="jump(\''+_url+'\')">'
                    +'<div class="list">'
                    +'<span class="title">'+list.publisher+'</span>'
                    +'<span class="sent_time">'
                    +'<span >'+list.time+'</span>'
                    +'</span>'
                    +'<span class="yuan '+_cliass+'">'+list.title+'</span>'
                    +'</div>'
                    +Img
                    +'</div>'
                    +'</li>'
        }
        $('#list-block-company ul').append(html);
    }

</script>
{/block}