{extend name="public/common"}

{block name="style"}
<link rel="stylesheet" href="/home/css/mediation/application.css">
<link rel="stylesheet" href="/home/css/mediation/iosselect.css">
<link rel="stylesheet" href="/home/css/easy_upload.css">
<title>事件申请</title>
{/block}
{block name="body"}
<div class="form">
    <div class="box">
        <div class="ev">
            <img class="star" src="/home/images/lxyz/icon/star.png"  alt=""/>
            <span>事件名称 ：</span>
        </div>
        <input type="text" placeholder="请输入事件名称" size="28"/>
    </div>
    <div class="box events">
        <div class="ev">
            <img class="star" src="/home/images/lxyz/icon/star.png"  alt=""/>
            <span>事件类型 ：</span>
        </div>
        <div class="event" id="showBank">
             <!--<span class="chose"> 请选择事件类型</span>-->
             <img class="icon3" src="/home/images/lxyz/icon/icon3.png"  alt=""/>
            <div class="pc-box">
                <input type="hidden" name="bank_id" id="bankId" value="">
                <span >请选择事件类型</span>
            </div>
        </div>
    </div>
    <div class="box">
        <div class="ev">
            <img class="star" src="/home/images/lxyz/icon/star.png"  alt=""/>
            <span>当事人 ：</span>
        </div>
        <input  type="text" placeholder="请输入当事人名称" size="28"/>
    </div>
    <div class="box">
        <div class="ev">
            <img class="star"  src="/home/images/lxyz/icon/star.png"  alt=""/>
            <span>申请人 ：</span>
        </div>
        <input type="text"  placeholder="请输入申请人名称" size="30"/>
    </div>
    <div class="box">
        <div class="ev">
            <img class="star"  src="/home/images/lxyz/icon/star.png"  alt=""/>
            <span>联系电话 ：</span>
        </div>
        <input type="number"  placeholder="请输入联系电话" size="28" style="text-indent: .5vw;" id="phone">
    </div>
    <div class="describe">
        <textarea name="content" id="text" placeholder="请对您的纠纷进行描述" maxlength="1000"></textarea>
        <div id="easyContainer"></div>
    </div>
    <div class="box last">
        <img class="star"  src="/home/images/lxyz/icon/star.png"  alt=""/>
        <span>选择调解员 :</span>
        <div class="med">
            <img class="image" src="/home/images/lxyz/icon/not.png"  alt=""/>
            <span class="name">芊芊</span>
            <span class="g">
                <img class="icon2"  src="/home/images/lxyz/icon/icon2.png"  alt=""/>
            </span>
        </div>
    </div>
    <!--<div class="present">-->
        <!--提交申请-->
    <!--</div>-->
</div>
<div class="container"></div>
{/block}

{block name="script"}
<script src="/home/js/iscroll.js"></script>
<script src="/home/js/iosselect.js"></script>
<script src="/home/js/easyupload.js"></script>
<script>
    //    $('.easy_upload_head_btn1').on('click',function(){
    //        alert(1)
    //    })
    $('#easyContainer').easyUpload({
        allowFileTypes: '*.jpg;*.png;*.gif;',//允许上传文件类型，格式';*.doc;*.pdf'
        allowFileSize: 100000,//允许上传文件大小(KB)
        selectText: '<img src="/home/images/icon_xx.png" style="width:60%;">',//选择文件按钮文案
        multi: true,//是否允许多文件上传
        multiNum: 4,//多文件上传时允许的文件数
        showNote: true,//是否展示文件上传说明
        note: '请上传您的证据（可为空，限9张，大小限5m）',//文件上传说明
        showPreview: true,//是否显示文件预览
        url: '/api/file/upload',//上传文件地址
        fileName: 'file',//文件filename配置参数
//        formParam: {
//            token: $.cookie('token_cookie')//不需要验证token时可以去掉
//        },//文件filename以外的配置参数，格式：{key1:value1,key2:value2}
        timeout: 30000,//请求超时时间
        successFunc: function(res) {
            console.log('成功回调', res);
        },//上传成功回调函数
        errorFunc: function(res) {
            console.log('失败回调', res);
        },//上传失败回调函数
        deleteFunc: function(res) {
            console.log('删除回调', res);
        }//删除文件回调函数
    });
</script>
<script>

//$(function () {
//    $('.events').on('click',function(e){
//        e.stopPropagation();
//        $('body').css({position:' fixed', width:'100%'})
//        if($('.nav').css('display')=='none'){
//            $('.icon3').css('transform','rotate(180deg)')
//        }else{
//            $('.icon3').css('transform','rotate(0)')
//            $('body').css({position:'relative'})
//        }
//        $('.nav').stop().fadeToggle("slow");
//    })
//    $('.nav li').on('click',function(e){
//        e.stopPropagation();
//        $(this).addClass('color').siblings().removeClass('color');
////        $('.nav').fadeOut();
//        if($('.nav').css('display')=='none'){
//            $('.icon3').css('transform','rotate(180deg)')
//        }else{
//            $('.icon3').css('transform','rotate(0)')
//        }
//        $('.nav').stop().fadeToggle("slow");
//        $('body').css({position:'relative'})
//        var val=$(this).html();
//        $('.chose').html(val);
//    })
//    $('.form').on('click',function(){
//        $('.nav').stop().fadeOut();
//        $('body').css({position:'relative'})
//        if($('.nav').css('display')=='block') {
//            $('.icon3').css('transform', 'rotate(0)');
//        }
//    })
//})

    $('.last').on('click',function(){
        window.location.href='/home/mediation/applicationdetail.html'
    })

//        $(function(){
//            //上传
//            $('.present' ).on('click',function(){
//                var content = $("textarea[name='content']").val();
//                var img = $('.img img' );
//                var data;
//                var images = [];
//                var imglen = img.length;
//                if(imglen > 0){
//                    for(var i =0 ;i< imglen ;i++){
//                        images.push(img.eq(i ).attr('data-tab'));
//                    }
//                    data ={
//                        content:content,
//                        images:images
//                    };
//                }else{
//                    data ={
//                        content:content,
//                        images:''
//                    };
//                }
//                if(content != ''){
//                    var tnum =  $('textarea').val().length;
//                    if(tnum <= 400){
//                        // 弹窗
//                        swal({
//                                title: ' ',
//                                text: '我已完成编辑，马上发送！',
//                                type: 'success',
//                                showCancelButton: true,
//                                confirmButtonText:'确定',
//                                cancelButtonText: "取消",
//                                closeOnConfirm: false
//                            },
//                            function(){
//                                $(".sweet-alert .sa-confirm-button-container").css("display","none");
//                                swal("", "发送中...", "success");
//                                $.ajax({
//                                    type:"post",
//                                    url: "{:Url('Feedback/publish')}",
//                                    data:data,
//                                    success:function(data){
//                                        setTimeout(function(){
//                                            window.location.href = "{:Url('Feedback/index')}";
//                                        },800);
//                                    }
//                                });
//                            });
//                    }else{
//                        swal({
//                            title: ' ',
//                            text: '请输入少于400字的意见！',
//                            type: 'error',
//                            confirmButtonText:'确定',
//                            timer:3000
//                        });
//                    }
//                }else{
//                    swal({
//                        title: ' ',
//                        text: '请输入您的意见后上传!',
//                        type: 'error',
//                        confirmButtonText:'确定',
//                        timer:2500
//                    });
//                }
//            });
//            //--------------------------------------------------------------------------
//            //
//            // 清除同一张图片再次上传bug
//            function clearImg() {
//                $("input[type = 'file']").remove();
//            }
//
//            function addImg() {
//                var addImg = '<input type="file" class="hide" id="upimg" accept="image/jpg, image/png, image/gif, image/jpeg">';
//                $(".imgs").append(addImg);
//            }
//
//            //--------------------------------------------------------------------------
////            图片预览
//            $('.new' ).on('click',function(){
//                var imglen = $('.img img' ).length;
//                var this_ = $(this );
//                var loading = $('.loading');
//
//                $('#upimg').click().off("change").on('change',function(){
//                    var size = ($(this)[0].files[0].size / 1024).toFixed(2);
//                    if(size <= 5120){
//                        var img = $(this)[0].files[0];
//                        var formData = new FormData();
//                        formData.append("picture",img);
//                        $.ajax({
//                            type: "post",
//                            url: "{:Url('File/uploadPicture')}",
//                            data: formData,
//                            processData : false,
//                            contentType : false,
//                            beforeSend: function(XMLHttpRequest){
//                                loading.toggleClass('hidden');
//                            },
//                            success:function(data){
//                                clearImg();
//                                console.log(data)
//                                var msg = $.parseJSON(data);
//                                loading.toggleClass('hidden');
//                                if(msg.code == 1){
//                                        //图片添加
//                                        if(imglen == 3){
//                                            $('.add' ).hide()
//                                        }
//                                        $('.img').eq(imglen).removeClass('hide' )
//                                            .append('<img src='+msg.data.path+' alt="笔记图片" data-tab='+msg.data.id+'>');
//                                        if(imglen>=0){
//                                               $('.x').on('click',function(){
//                                                   console.log(11111)
//                                                $(this).parents(".img").remove();
//                                                $('.add').before('<div class="img fl hide"><span class="x">X</span></div>')
//                                                if(imglen<4){
//                                                    $('.add' ).show();
//                                                }
//                                            })
//                                        }
//                                    imgresize();
//
//                                }
//                                else {
//                                    swal({
//                                        title: '上传失败',
////                                        html: '上传失败',
//                                        type: 'error',
//                                        showConfirmButton:false,
//                                        timer:1500
//                                    });
//                                }
//                                addImg();
//                            }
//                        });
//                    }
//                    else {
//                        clearImg();
//                        swal({
//                            title: ' ',
//                            text: '您的图片超过5M',
//                            type: 'warning',
//                            showConfirmButton:false,
//                            timer:1500
//                        });
//                        addImg();
//                    }
//                });
//
//            });
//
//            // 字数限定
//            numlimit(400)
//        });
        $(function(){
            //上传
            $('.present' ).on('click',function(){
                var content = $("textarea[name='content']").val();
                var img = $('.img img' );
                var data;
                var images = [];
                var imglen = img.length;
                if(imglen > 0){
                    for(var i =0 ;i< imglen ;i++){
                        images.push(img.eq(i ).attr('data-tab'));
                    }
                    data ={
                        content:content,
                        images:images
                    };
                }else{
                    data ={
                        content:content,
                        images:''
                    };
                }
                if(content != ''){
                    var tnum =  $('textarea').val().length;
                    if(tnum <= 400){
                        // 弹窗
                        swal({
                                title: ' ',
                                text: '我已完成编辑，马上发送！',
                                type: 'success',
                                showCancelButton: true,
                                confirmButtonText:'确定',
                                cancelButtonText: "取消",
                                closeOnConfirm: false
                            },
                            function(){
                                $(".sweet-alert .sa-confirm-button-container").css("display","none");
                                swal("", "发送中...", "success");
                                $.ajax({
                                    type:"post",
//                                    url: "{:Url('Feedback/publish')}",
                                    data:data,
                                    success:function(data){
                                        setTimeout(function(){
//                                            window.location.href = "{:Url('Feedback/index')}";
                                        },800);
                                    }
                                });
                            });
                    }else{
                        swal({
                            title: ' ',
                            text: '请输入少于400字的意见！',
                            type: 'error',
                            confirmButtonText:'确定',
                            timer:3000
                        });
                    }
                }else{
                    swal({
                        title: ' ',
                        text: '请输入您的意见后上传!',
                        type: 'error',
                        confirmButtonText:'确定',
                        timer:2500
                    });
                }
            });
            //--------------------------------------------------------------------------
            //
            // 清除同一张图片再次上传bug
            function clearImg() {
                $("input[type = 'file']").remove();
            }

            function addImg() {
                var addImg = '<input type="file" class="hide" id="upimg" accept="image/jpg, image/png, image/gif, image/jpeg">';
                $(".imgs").append(addImg);
            }

            //--------------------------------------------------------------------------
//            图片预览
            $('.new' ).on('click',function(){
                var imglen = $('.img img' ).length;
                var this_ = $(this );
                var loading = $('.loading');
                $('#upimg').click().off("change").on('change',function(){
                    var size = ($(this)[0].files[0].size / 1024).toFixed(2);
                    if(size <= 5120){
                        var img = $(this)[0].files[0];
                        var formData = new FormData();
                        formData.append("picture",img);
                        $.ajax({
                            type: "post",
                            url: "{:Url('File/uploadPicture')}",
                            data: formData,
                            processData : false,
                            contentType : false,
                            beforeSend: function(XMLHttpRequest){
                                loading.toggleClass('hidden');
                            },
                            success:function(data){
                                clearImg();
                                var msg = $.parseJSON(data);
                                loading.toggleClass('hidden');
                                if(msg.code == 1){
                                        //图片添加
                                        if(imglen == 3){
                                            $('.add' ).hide()
                                        }
                                        $('.img').eq(imglen).removeClass('hide' )
                                            .append('<img src='+msg.data.path+' alt="笔记图片" data-tab='+msg.data.id+'>');
                                        if(imglen>=0){
                                               $('.x').on('click',function(){
                                                   console.log(11111)
                                                $(this).parents(".img").remove();
                                                $('.add').before('<div class="img fl hide"><span class="x">X</span></div>')
                                                if(imglen<4){
                                                    $('.add' ).show();
                                                }
                                            })
                                        }
                                    imgresize();

                                } else {
                                    swal({
                                        title: ' ',
                                        html: '上传失败',
                                        type: 'error',
                                        showConfirmButton:false,
                                        timer:1500
                                    });
                                }
                                addImg();
                            }
                        });
                    } else {
                        clearImg();
                        swal({
                            title: ' ',
                            text: '您的图片超过5M',
                            type: 'warning',
                            showConfirmButton:false,
                            timer:1500
                        });
                        addImg();
                    }
                });

            });

            // 字数限定
            numlimit(400)
        });
        function imgresize(){
            setTimeout(function(){
                var img = $('.img img' );
                img.each(function(){
                    if($(this).width() == $(this).height()){
                        $(this).height('20.8vw');
                        $(this).width('20.8vw');
                    }else if($(this).width() > $(this).height()){
                        $(this).height('20.8vw' ).css({'left':-$(this).width()/2+78/2});
                    }else{
                        $(this).width('20.8vw').css({'top':-$(this).height()/2+78/2});
                    }
                });
            },100);
        }
        function numlimit(n){
            var textarea = $('textarea');
            var lock = false;
            textarea.on('compositionstart',function(){
                lock = true;
            });
            textarea.on('compositionend',function(){
                lock = false;
            });
            textarea.on('input',function(){
                if(!lock){
                    //键盘输入
                    var text = $(this).val();
                    text = text.substring(0,n);
                    var num = text.length;
                    $(this).val(text);
                    $('.contentnum span').text(num);
                }
            });
            textarea.bind("paste",function(){
                //黏贴输入
                var text = $(this).val();
                text = text.substring(0,n);
                var num = text.length;
                $(this).val(text);
                $('.contentnum span').text(num);
            }).css("ime-mode", "disabled"); //CSS设置输入法不可用
        }


</script>
<script type="text/javascript">

var data = [
    {'id': '10001', 'value': '妇女儿童与残疾人维权'},
    {'id': '10002', 'value': '劳动就业及社会保障'},
    {'id': '10003', 'value': '婚姻家庭与遗产纠纷'},
    {'id': '10004', 'value': '交通事故与医患纠纷'},
    {'id': '10005', 'value': '债权及损害赔偿'},
    {'id': '10006', 'value': '网络交易与购物纠纷'},
    {'id': '10007', 'value': '旅游消费与保险纠纷'},
    {'id': '10008', 'value': '房地产与物业纠纷'},
    {'id': '10009', 'value': '债权债务及合同纠纷'},
    {'id': '10010', 'value': '刑事诉讼其他纠纷'}
];
    var showBankDom = document.querySelector('#showBank');
    var bankIdDom = document.querySelector('#bankId');
    showBankDom.addEventListener('click', function () {
        var bankId = showBankDom.dataset['id'];
        var bankName = showBankDom.dataset['value'];
        console.log(data)
        var bankSelect = new IosSelect(1,
            [data],
            {
                container: '.container',
                title: '事件选择',
                itemHeight: 60,
                itemShowCount: 3,
                oneLevelId: bankId,
                callback: function (selectOneObj) {
                    bankIdDom.value = selectOneObj.id;
                    showBankDom.innerHTML = selectOneObj.value;
                    showBankDom.dataset['id'] = selectOneObj.id;
                    showBankDom.dataset['value'] = selectOneObj.value;
                }
            });
    });
</script>

<script>
$("#phone").bind("input propertychange",function(){
    var reg = new RegExp("^[0-9]*$");
    var obj = document.getElementById("phone");
    if(!reg.test(obj.value)){
        $(this).val('')
    }
    if(!/^[0-9]*$/.test(obj.value)){
        $(this).val('')
    }
});
</script>
{/block}