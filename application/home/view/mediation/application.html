{extend name="public/common"}

{block name="style"}
<link rel="stylesheet" href="/home/css/mediation/application.css">
<title>事件申请</title>
{/block}
{block name="body"}
<div class="form">
    <div class="box">
        <div class="ev">
            <img class="star" src="/home/images/lxyz/icon/star.png"  alt=""/>
            <span>事件名称 ：</span>
        </div>
        <input type="text" placeholder="请输入事件名称" size="28"/>
    </div>
    <div class="box events">
        <div class="ev">
            <img class="star" src="/home/images/lxyz/icon/star.png"  alt=""/>
            <span>事件类型 ：</span>
        </div>
        <div class="event">
             <span class="chose"> 请选择事件类型</span>
             <img class="icon3" src="/home/images/lxyz/icon/icon3.png"  alt=""/>
             <ul class="nav">
                <li>妇女儿童与残疾人维权</li>
                <li>劳动就业及社会保障</li>
                <li>婚姻家庭与遗产纠纷</li>
                <li>交通事故与医患纠纷</li>
                <li>债权及损害赔偿</li>
                <li>网络交易与购物纠纷</li>
                <li>旅游消费与保险纠纷</li>
                <li>房地产与物业纠纷</li>
                <li>债权债务及合同纠纷</li>
                <li>刑事诉讼其他纠纷</li>
             </ul>
        </div>
    </div>
    <div class="box">
        <div class="ev">
            <img class="star" src="/home/images/lxyz/icon/star.png"  alt=""/>
            <span>当事人 ：</span>
        </div>
        <input  type="text" placeholder="请输入当事人名称" size="28"/>
    </div>
    <div class="box">
        <div class="ev">
            <img class="star"  src="/home/images/lxyz/icon/star.png"  alt=""/>
            <span>申请人 ：</span>
        </div>
        <input type="text"  placeholder="请输入申请人名称" size="30"/>
    </div>
    <div class="box">
        <div class="ev">
            <img class="star"  src="/home/images/lxyz/icon/star.png"  alt=""/>
            <span>联系电话 ：</span>
        </div>
        <input onkeyup="value=value.replace(/[^\d]/g,'') " placeholder="请输入联系电话" size="28" style="text-indent: .5vw;"  onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\d]/g,''))">
    </div>
    <div class="describe">
        <textarea name="content" id="text" placeholder="请对您的纠纷进行描述" maxlength="1000"></textarea>
        <div class="imgs clear">
            <div class="img fl hide"></div>
            <div class="img fl hide"></div>
            <div class="img fl hide"></div>
            <div class="img fl hide"></div>
            <div class="add">
                <div class="new">
                    <img class="newimg" src="/home/images/lxyz/icon/new.png"  alt=""/>
                </div>
            </div>
            <input type="file" class="hide" id="upimg" accept="image/*">
        </div>
        <p>请上传您的证据，（可为空，限4张）</p>
    </div>
    <div class="box last">
        <img class="star"  src="/home/images/lxyz/icon/star.png"  alt=""/>
        <span>选择调解员 :</span>
        <div class="med">
            <img class="image" src="/home/images/lxyz/icon/not.png"  alt=""/>
            <span class="name">芊芊</span>
            <span class="g">
                <img class="icon2"  src="/home/images/lxyz/icon/icon2.png"  alt=""/>
            </span>
        </div>
    </div>
    <div class="present">
        提交申请
    </div>
</div>
{/block}

{block name="script"}

<script>
$(function () {
    $('.events').on('click',function(e){
        e.stopPropagation();
        $('body').css({position:' fixed', width:'100%'})
        if($('.nav').css('display')=='none'){
            $('.icon3').css('transform','rotate(180deg)')
        }else{
            $('.icon3').css('transform','rotate(0)')
            $('body').css({position:'relative'})
        }
        $('.nav').stop().fadeToggle("slow");
    })
    $('.nav li').on('click',function(e){
        e.stopPropagation();
        $(this).addClass('color').siblings().removeClass('color');
//        $('.nav').fadeOut();
        if($('.nav').css('display')=='none'){
            $('.icon3').css('transform','rotate(180deg)')
        }else{
            $('.icon3').css('transform','rotate(0)')
        }
        $('.nav').stop().fadeToggle("slow");
        $('body').css({position:'relative'})
        var val=$(this).html();
        $('.chose').html(val);
    })
    $('.form').on('click',function(){
        $('.nav').stop().fadeOut();
        $('body').css({position:'relative'})
        if($('.nav').css('display')=='block') {
            $('.icon3').css('transform', 'rotate(0)');
        }
    })
})
    $('.new' ).on('click',function(){
        var imglen = $('.img .img1' ).length;
        var this_ = $(this );
        $('#upimg').click().off("change").on('change',function(){
            var img = $(this)[0].files[0];
            console.log($(this)[0].files[0].size)
            var size=$(this)[0].files[0].size;
            if(size>22000){
                var oFReader = new FileReader();
                oFReader.readAsDataURL(img);
                oFReader.onloadend = function(oFRevent) {
                    if(imglen >= 3){
                        $('.add' ).hide();
                    }
                    if(imglen ==0){
                        $('.describe p').html('点击任意图片删除最后一张');
                    }
                    var image = new Image()
                    console.log(image)
                    image.src = oFRevent.target.result;
                        // 创建一个 canvas 元素并获取其上下文
                    var canvas=document.createElement('canvas')
                    var ctx = canvas.getContext("2d");
                    canvas.width = $('.img').width();
                    canvas.height = $('.img').height();
                        // 绘制图片
                    ctx.drawImage(image, 0, 0, image.width, image.height, 0, 0, canvas.width, canvas.height)
                    var dataUrl = canvas.toDataURL('image/jpeg', 0.4);
                    $('.imgs .img').eq(imglen).removeClass('hide' )
                        .append('<img class="img1" src='+dataUrl+' alt="图片" >');
                }
//                alert('图片太大无法上传')
            }else{
                var oFReader = new FileReader();
                oFReader.readAsDataURL(img);
                oFReader.onloadend = function(oFRevent){
                    var src = oFRevent.target.result;
                    //图片添加
                    if(imglen >= 3){
                        $('.add' ).hide();
                        $('.describe p').hide();
                    }
                    $('.imgs .img').eq(imglen).removeClass('hide' )
                        .append('<img class="img1" src='+src+' alt="图片" >');
                }
            }
        });
        $('.imgs .img').on('click',function(){
            console.log($(this).index())
            var len =$('.imgs .img .img1').length;
            $(this).addClass('hide')
            $(this).parent().find('.img').eq(imglen).find('img').remove();
            if($('.imgs .img .img1').length <4){
                $('.add' ).show();
            }
        })

    });

//        $(function(){
//            //上传
//            $('.sure' ).on('click',function(){
//                var content = $("textarea[name='content']").val();
//                var img = $('.img img' );
//                var data;
//                var images = [];
//                var imglen = img.length;
//                if(imglen > 0){
//                    for(var i =0 ;i< imglen ;i++){
//                        images.push(img.eq(i ).attr('data-tab'));
//                    }
//                    data ={
//                        content:content,
//                        images:images
//                    };
//                }else{
//                    data ={
//                        content:content,
//                        images:''
//                    };
//                }
//                if(content != ''){
//                    var tnum =  $('textarea').val().length;
//                    if(tnum <= 400){
//                        // 弹窗
//                        swal({
//                                title: ' ',
//                                text: '我已完成编辑，马上发送！',
//                                type: 'success',
//                                showCancelButton: true,
//                                confirmButtonText:'确定',
//                                cancelButtonText: "取消",
//                                closeOnConfirm: false
//                            },
//                            function(){
//                                $(".sweet-alert .sa-confirm-button-container").css("display","none");
//                                swal("", "发送中...", "success");
//                                $.ajax({
//                                    type:"post",
//                                    url: "{:Url('Feedback/publish')}",
//                                    data:data,
//                                    success:function(data){
//                                        setTimeout(function(){
//                                            window.location.href = "{:Url('Feedback/index')}";
//                                        },800);
//                                    }
//                                });
//                            });
//                    }else{
//                        swal({
//                            title: ' ',
//                            text: '请输入少于400字的意见！',
//                            type: 'error',
//                            confirmButtonText:'确定',
//                            timer:3000
//                        });
//                    }
//                }else{
//                    swal({
//                        title: ' ',
//                        text: '请输入您的意见后上传!',
//                        type: 'error',
//                        confirmButtonText:'确定',
//                        timer:2500
//                    });
//                }
//            });
//            //--------------------------------------------------------------------------
//            //
//            // 清除同一张图片再次上传bug
//            function clearImg() {
//                $("input[type = 'file']").remove();
//            }
//
//            function addImg() {
//                var addImg = '<input type="file" class="hide" id="upimg" accept="image/jpg, image/png, image/gif, image/jpeg">';
//                $(".imgs").append(addImg);
//            }
//            //
//            //--------------------------------------------------------------------------
//            //图片预览
//            $('.add' ).on('click',function(){
//                var imglen = $('.img img' ).length;
//                var this_ = $(this );
//                var loading = $('.loading');
//                $('#upimg').click().off("change").on('change',function(){
//                    var size = ($(this)[0].files[0].size / 1024).toFixed(2);
//                    if(size <= 2048){
//                        var img = $(this)[0].files[0];
//                        var formData = new FormData();
//                        formData.append("picture",img);
//                        $.ajax({
//                            type: "post",
//                            url: "{:Url('File/uploadPicture')}",
//                            data: formData,
//                            processData : false,
//                            contentType : false,
//                            beforeSend: function(XMLHttpRequest){
//                                loading.toggleClass('hidden');
//                            },
//                            success:function(data){
//                                clearImg();
//                                var msg = $.parseJSON(data);
//                                loading.toggleClass('hidden');
//                                if(msg.code == 1){
//                                    if(this_.hasClass('add')){
//                                        //图片添加
//                                        if(imglen == 3){
//                                            $('.add' ).fadeOut();
//                                        }
//                                        $('.img').eq(imglen).removeClass('hide' )
//                                            .append('<img src='+msg.data.path+' alt="笔记图片" data-tab='+msg.data.id+'>');
//                                    }else{
//                                        //图片修改
//                                        this_.find('img').remove();
//                                        this_.append('<img src='+msg.data.path+' alt="笔记图片" data-tab='+msg.data.id+'>');
//                                    }
//                                    imgresize();
//
//                                } else {
//                                    swal({
//                                        title: ' ',
//                                        html: '上传失败',
//                                        type: 'error',
//                                        showConfirmButton:false,
//                                        timer:1500
//                                    });
//                                }
//                                addImg();
//                            }
//                        });
//                    } else {
//                        clearImg();
//                        swal({
//                            title: ' ',
//                            text: '您的图片超过2M',
//                            type: 'warning',
//                            showConfirmButton:false,
//                            timer:1500
//                        });
//                        addImg();
//                    }
//                });
//
//            });
//
//            // 字数限定
//            numlimit(400)
//        });
//        function imgresize(){
//            setTimeout(function(){
//                var img = $('.img img' );
//                img.each(function(){
//                    if($(this).width() == $(this).height()){
//                        $(this).height('20.8vw');
//                        $(this).width('20.8vw');
//                    }else if($(this).width() > $(this).height()){
//                        $(this).height('20.8vw' ).css({'left':-$(this).width()/2+78/2});
//                    }else{
//                        $(this).width('20.8vw').css({'top':-$(this).height()/2+78/2});
//                    }
//                });
//            },100);
//        }
//        function numlimit(n){
//            var textarea = $('textarea');
//            var lock = false;
//            textarea.on('compositionstart',function(){
//                lock = true;
//            });
//            textarea.on('compositionend',function(){
//                lock = false;
//            });
//            textarea.on('input',function(){
//                if(!lock){
//                    //键盘输入
//                    var text = $(this).val();
//                    text = text.substring(0,n);
//                    var num = text.length;
//                    $(this).val(text);
//                    $('.contentnum span').text(num);
//                }
//            });
//            textarea.bind("paste",function(){
//                //黏贴输入
//                var text = $(this).val();
//                text = text.substring(0,n);
//                var num = text.length;
//                $(this).val(text);
//                $('.contentnum span').text(num);
//            }).css("ime-mode", "disabled"); //CSS设置输入法不可用
//        }

    $('.last').on('click',function(){
        window.location.href='/home/mediation/applicationdetail.html'
    })

</script>
{/block}