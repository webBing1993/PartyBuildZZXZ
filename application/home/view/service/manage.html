{extend name="public/common"}

{block name="style"}
<link rel="stylesheet" href="/home/css/service/manage.css">
<title>党员管理</title>
{/block}
{block name="body"}
<!--切换-->
<div class="tabs">
    <span class="tab active">党员展示</span>
    <span class="tab">参会情况</span>
    <span class="tab" >流程展示</span>
</div>
<!--三个模块-->
    <div class="boxs">
        <!--党员展示模块-->
        <div class="box ">
            <div class="loading hidden">
                <div class="typing_loader"></div>
            </div>
            <div class="tip"></div>
        </div>
        <!--参会情况模块-->
        <div class="box" style="display:none;">
            <!--列表-->
            <div class="lists">
                <a href="#" class="list">
                    <img data-original="/home/images/banner/1.jpg" alt="图片展示" class="lazy">
                    <div class="lr">
                        <div class="title">
                            <p>2017年度山下湖镇党支部考核情况</p>
                        </div>
                        <span class="time">2018-01-08</span>
                        <span class="message">30</span>
                    </div>
                </a>
                <a href="#" class="list">
                    <img data-original="/home/images/banner/1.jpg" alt="图片展示" class="lazy">
                    <div class="lr">
                        <div class="title">
                            <p>2017年度山下湖镇党支部考核情况</p>
                        </div>
                        <span class="time">2018-01-08</span>
                        <span class="message">30</span>
                    </div>
                </a>
            </div>
            <div class="loading hidden">
                <div class="typing_loader"></div>
            </div>
            <div class="tip"></div>
        </div>
        <!--流程展示模块-->
        <div class="box flow" style="display:none;">
            <!--列表-->
            <div class="lists">
                <a href="#" class="list">
                    <img data-original="/home/images/banner/1.jpg" alt="图片展示" class="lazy">
                    <div class="lr">
                        <p>党组织关系转接流程</p>
                    </div>
                </a>
                <a href="#" class="list">
                    <img data-original="/home/images/banner/1.jpg" alt="图片展示" class="lazy">
                    <div class="lr">
                        <p>党员发展流动党员管理、党组织基本制度执行流程介绍党员发展流动党员管理、党组织基本制度执行流程介绍</p>
                    </div>
                </a>
            </div>
            <div class="loading hidden">
                <div class="typing_loader"></div>
            </div>
            <div class="tip"></div>
        </div>
    </div>

{/block}

{block name="script"}

<script>
    $(function(){
        $(".tab").on('click',function(){
            var index=$(this).index();
            $(this).addClass('active').siblings().removeClass('active');
            $(".box").eq(index).show().siblings().hide();
            localStorage.setItem('data',index);
        });
        var number = localStorage.getItem('data')==null?0:localStorage.getItem('data');
        $('.tabs .tab').removeClass('active');
        $('.tabs .tab').eq(number).addClass('active');
        $(".box").eq(number).show().siblings().hide();;


        $("img.lazy").lazyload({
            placeholder: "/home/images/loading.jpg",
            effect: "fadeIn",
            threshold : 500
        });
        $(document).scroll(function() {
            $("img.lazy").lazyload({
                placeholder: "/home/images/loading.jpg",
                effect: "fadeIn",
                threshold: 1
            });
        });
    });
    var scrollNow = true;
    //    loadScroll()
    function loadScroll(){
        $(window ).off("scroll" ).on("scroll",function(){
            var dh = $(document).height();
            var end = $(window).height() + $(window ).scrollTop();
            var len = $('.list').length;
            var tip = $(".tip");
            var loading = $('.loading');
            if(dh == end && scrollNow){
                scrollNow = false;
                $.ajax({
                    type:"post",
                    url: "",
                    data:{
                        type:type,
                        length:len
                    },
                    beforeSend: function(XMLHttpRequest){
                        tip.hide();
                        loading.toggleClass('hidden');
                    },
                    success:function(data){
                        console.log(data)
                        loading.toggleClass('hidden');
                        tip.show();
                        if(data.code == 1){
                            var dataLen =data.data.length;
                            if(data.data.length >= 2){
                                tip.text('上拉加载更多');
                            } else {
                                tip.text('没有更多了');
                                $(window ).off("scroll");
                            }
                        }else{
                            tip.text('没有更多了');
                            $(window ).off("scroll");
                        }
                        scrollNow = true;
                    }
                })
            }
        })
    }

</script>
{/block}